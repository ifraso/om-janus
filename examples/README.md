# Examples

This directory contains example files to help you understand the data structures used by Janus for database users and roles migration.

## Files

### dbUsers.example.json

This is an example of the JSON file generated by the `db-users export` command.

**Structure:**
- Array of project objects
- Each project contains:
  - `project`: Project metadata (id and name)
  - `customRoles`: Array of custom role definitions
  - `databaseUsers`: Array of database user definitions

**Custom Role Structure:**
```json
{
  "role": "customAppRole",
  "db": "myDatabase",
  "privileges": [
    {
      "resource": {
        "db": "myDatabase",
        "collection": "users"
      },
      "actions": ["find", "insert", "update"]
    }
  ],
  "roles": [
    {
      "role": "read",
      "db": "admin"
    }
  ]
}
```

**Database User Structure:**
```json
{
  "username": "appUser",
  "databaseName": "admin",
  "roles": [
    {
      "role": "readWrite",
      "db": "myDatabase"
    },
    {
      "role": "customAppRole",
      "db": "myDatabase"
    }
  ]
}
```

**Note:** Passwords are NOT included in the export file. They are generated during import.

### passwords.example.csv

This is an example of the CSV file generated by the `db-users import` command containing the randomly generated passwords.

**CSV Columns:**
- `timestamp`: When the user was created
- `source_project`: Name of the source project
- `source_project_id`: ID of the source project
- `destination_project`: Name of the destination Atlas project
- `destination_project_id`: ID of the destination Atlas project
- `username`: Database username
- `auth_database`: Authentication database (typically "admin")
- `password`: Generated password (20 characters, secure random)
- `roles`: Semicolon-separated list of roles in format `roleName@databaseName`

**Security Warning:** 
⚠️ This file contains plaintext passwords! Handle with extreme care:
- Never commit to version control
- Share securely with application owners only
- Rotate all passwords immediately after migration
- Delete the file after passwords have been updated

## Usage Example

### 1. Export from Ops Manager/Cloud Manager

```bash
python -m janus db-users export \
  --sourceUrl https://cloud.mongodb.com \
  --sourceUsername myuser \
  --sourceApiKey xxxx-xxxx-xxxx \
  --outputFile dbUsers.json
```

This creates a file similar to `dbUsers.example.json`.

### 2. Import to Atlas

```bash
python -m janus db-users import \
  --destinationUrl https://cloud.mongodb.com \
  --destinationUsername atlasuser \
  --destinationApiKey yyyy-yyyy-yyyy \
  --inputFile dbUsers.json \
  --passwordOutputFile passwords.csv \
  --skipExisting true
```

This creates a file similar to `passwords.example.csv` with actual generated passwords.

### 3. Post-Migration Steps

1. **Update Application Connection Strings**
   - Use the passwords from the CSV file
   - Update all applications to connect to Atlas

2. **Test Connectivity**
   - Verify each user can connect
   - Verify role permissions work correctly

3. **Rotate Passwords**
   - Use Atlas UI or API to rotate all passwords
   - Update application connection strings again

4. **Clean Up**
   - Delete the passwords CSV file
   - Store new passwords in a secrets manager

## Notes

- Custom roles are created before users (users reference roles)
- If `skipExisting` is true, existing users/roles are skipped (no duplicates)
- All passwords are 20+ characters with mixed case, digits, and special characters
- Built-in MongoDB roles (like `readWrite`, `dbAdmin`) work across Ops Manager and Atlas
- Custom roles are migrated with their complete privilege definitions